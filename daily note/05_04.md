# 05ì›” 04ì¼

## Telegram CAHTBOT ë§Œë“¤ê¸°(ì‹¤ìŠµ)

### .env íŒŒì¼
Key = Valueë¥¼ ì„¤ì •í•´ë†“ìœ¼ë©´

python_doctenvë¥¼ í†µí•´ 

ë³´ì•ˆì„±ì´ í•„ìš”í•œ ë‹¨ì–´ë¥¼ í‚¤ê°’ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```
from dotenv import load_dotenv
import os

load_dotenv()
TOKEN = 
NAVER_CLIENT_ID =
NAVER_CLIENT_SECRET = 

ë“±ë“±
```

### í‚¤ì›Œë“œ ë§Œë“¤ê¸°

#### HTML
```python
import requests
from bs4 import BeautifulSoup

URL = 'https://search.naver.com/search.naver?sm=tab_hty.top&where=nexearch&query=%EB%A1%9C%EB%98%90%EB%8B%B9%EC%B2%A8%EB%B2%88%ED%98%B8&oquery=1065%ED%9A%8C+%EB%A1%9C%EB%98%90%EB%8B%B9%EC%B2%A8%EB%B2%88%ED%98%B8&tqi=iac3kwp0J1ZssTf7Qylssssss%2BV-399732'

res =requests.get(URL)

soup = BeautifulSoup(res.text, 'html.parser')

no1 = soup.select_one('#main_pack > div.sc_new.cs_lotto._lotto > div > div.content_area > div > div > div:nth-child(2) > div.win_number_box > div > div.winning_number > span.ball.type1').text
no2 = soup.select_one('#main_pack > div.sc_new.cs_lotto._lotto > div > div.content_area > div > div > div:nth-child(2) > div.win_number_box > div > div.winning_number > span:nth-child(2)').text
no3 = soup.select_one('#main_pack > div.sc_new.cs_lotto._lotto > div > div.content_area > div > div > div:nth-child(2) > div.win_number_box > div > div.winning_number > span:nth-child(3)').text
no4 = soup.select_one('#main_pack > div.sc_new.cs_lotto._lotto > div > div.content_area > div > div > div:nth-child(2) > div.win_number_box > div > div.winning_number > span.ball.type3').text
no5 = soup.select_one('#main_pack > div.sc_new.cs_lotto._lotto > div > div.content_area > div > div > div:nth-child(2) > div.win_number_box > div > div.winning_number > span.ball.type4').text
no6 = soup.select_one('#main_pack > div.sc_new.cs_lotto._lotto > div > div.content_area > div > div > div:nth-child(2) > div.win_number_box > div > div.winning_number > span.ball.type5').text
bonus_no = soup.select_one('#main_pack > div.sc_new.cs_lotto._lotto > div > div.content_area > div > div > div:nth-child(2) > div.win_number_box > div > div.bonus_number > span').text

prize = soup.select_one('#main_pack > div.sc_new.cs_lotto._lotto > div > div.content_area > div > div > div:nth-child(2) > div.win_number_box > p > strong').text

print('ë‹¹ì²¨ë²ˆí˜¸', no1, no2, no3, no4, no5, no6)
print('ë³´ë„ˆìŠ¤ë²ˆí˜¸', bonus_no)
print('ë‹¹ì²¨ê¸ˆì•¡', prize, 'ì›')
```

#### Json
```python
import requests

def get_lotto():
     URL = 'https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=1065'
     res =requests.get(URL)

     data = res.json()

     numbers = []

     for i in range(1, 7):
          numbers.append(data[f'drwtNo{i}'])

     return f"ë²ˆí˜¸: {numbers}, ë³´ë„ˆìŠ¤: {data['bnusNo']}, ìƒê¸ˆ: {data['firstWinamnt']}"
     
# print(get_lotto())

```
**ê°™ì€ ë‚´ìš©ì´ì§€ë§Œ JSONí˜•ì‹ì´ ì¢€ ë” ê°„ëµí•˜ë‹¤.(ê°œë°œìë¥¼ ìœ„í•´ ì œê³µí•˜ê¸° ë•Œë¬¸)**

### utils.py

ìœ„ í‚¤ì›Œë“œë¥¼ utils.py íŒŒì¼ì— í•¨ìˆ˜í™”í•œë‹¤.

```python
import requests
from bs4 import BeautifulSoup
from dotenv import load_dotenv
import os

load_dotenv()

NAVER_CLIENT_ID = os.environ['NAVER_CLIENT_ID']
NAVER_CLIENT_SECRET = os.environ['NAVER_CLIENT_SECRET']

def get_lotto():
     URL = 'https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=1065'
     res =requests.get(URL)

     data = res.json()

     numbers = []

     for i in range(1, 7):
          numbers.append(data[f'drwtNo{i}'])

     return f"ë²ˆí˜¸: {numbers}, ë³´ë„ˆìŠ¤: {data['bnusNo']}, ìƒê¸ˆ: {data['firstWinamnt']}"
```

### app.py 

í•¨ìˆ˜í™”í•œ í‚¤ì›Œë“œë¥¼  app.py íŒŒì¼ì„ ìƒì„± í›„ ë„£ì–´ telegram chatbotì— ì ìš©í•œë‹¤

```python
from flask import Flask, request
import requests
from dotenv import load_dotenv
import os

import utils

load_dotenv()


app = Flask('telegram-chatbot')

TOKEN = os.environ['BOT_TOKEN']
BASE_URL = f'https://api.telegram.org/bot{TOKEN}'


@app.route('/telegram', methods=['POST'])
def telegeram():
    data = request.json
    print('TELEGRAMì—ì„œ ìš”ì²­ì´ ë“¤ì–´ì™”ë‹¤!')
    chat_id = data['message']['from']['id']
    message = data['message']['text']

    if message == 'ì£¼ì‹':
        return_msg = utils.get_kospi()
    elif message in ['ë¡œë˜', 'lotto', 'Lotto']:
        return_msg = utils.get_lotto()
    elif message.split()[0] == 'ì‡¼í•‘':
        item = message.split()[1]
        return_msg = utils.get_naver_shopping(item)
    elif message == 'ê²Œì„ìˆœìœ„':
        return_msg = utils.get_Game_Rank()
    else:
        return_msg = 'ëª¨ë¥´ëŠ” ëª…ë ¹ì–´ ì…ë‹ˆë‹¤ ğŸ˜¢'
    
    requests.get(BASE_URL + f'/sendMessage?chat_id={chat_id}&text={return_msg}')

    

    # Response
    return 'Telegram CHATBOT'
    ```